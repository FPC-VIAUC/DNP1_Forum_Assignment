@page "/adduser"
@using ApiContracts
@using BlazorApp.Services
@inject IUsersService UsersService

<PageTitle>Add User</PageTitle>

<h3>Add a user</h3>

<div class="mt-4">
    Username: 
    <input @bind="Username"/>
</div>

<div class="mt-4">
    Password: 
    <input @bind="Password"/>
</div>

<p class="mt-4 text-danger">@ErrorMessage</p>
<p class="mt-4 text-success">@SuccessMessage</p>

<div class="mt-4">
    <button class="btn btn-primary" @onclick="OnSubmit">Submit</button>
</div>

@code {
    public string Username{ get; set; }
    public string Password{ get; set; }
    
    public string ErrorMessage{ get; set; }
    public string SuccessMessage{ get; set; }
    
    public async Task OnSubmit(){
        CreateUserDTO createUserDto = new CreateUserDTO(){
            Username = this.Username,
            Password = this.Password
        };
        try{
            UserDTO user = await UsersService.AddUserAsync(createUserDto);
            SuccessMessage = $"{user.Username} was successfully created!";
            ErrorMessage = "";

            Username = "";
            Password = "";
        } catch (Exception e){
            ErrorMessage = e.Message;
            SuccessMessage = "";
        }
    }
}